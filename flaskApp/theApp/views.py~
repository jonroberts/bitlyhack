from flask import render_template, flash, redirect, session, make_response
from theApp import app, db

import json
from tools import valueFromRequest
import os
import calendar
from flask import request
import datetime
from bitlyCalls import *
from sociocast import get_content_profile
from rovi import *


@app.route('/')
@app.route('/index')
def index():
    return render_template("index.html")


@app.route('/get_phrases')
def get_phrases():
    results = getBurstingPhrases()

    response = make_response(json.dumps(results))
    response.headers.add("Access-Control-Allow-Origin", "*")

    socio_results_dict = {}

    for each_item in response:
        for each_key in each_item.keys():
            if (each_key == "phrase"):
                phrase = each_item["phrase"]
            elif (each_key == "top_link"):
                # Pass top URL into sociocast to get classifications
                sociocast_url = each_item["top_link"]["aggregate_url"]

                socio_results_dict.add(get_content_profile(sociocast_url))

                # Could combine titles into unique tokens and remove
                # stop words for additional search keywords
#            elif (each_key == "titles"):
#                url_response = each_item["titles"]

            # Pass Sociocast results and Bit.ly phrase into Rovi to get
            # song results
            

    return songs_dict


@app.route('/get_hot_phrases')
def get_hot_phrases():
    results = getHotPhrases()

    response = make_response(json.dumps(results))
    response.headers.add("Access-Control-Allow-Origin", "*")

    return response
